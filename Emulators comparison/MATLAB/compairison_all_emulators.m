% MATLAB Script: comparison of the 3 curves + experimental points
clear; clc; close all

%% 1) Plotting the three curves + experimental points

figure('Color','w','Position',[100 100 900 500]);
hold on; grid on;

% Single-diode emulator - ME Solar MESM-50W (S = 1000 W/m^2 and T = 25°C)
% V_single_diode = [
%     0;
%     5.335613;
%     11.316692;
%     13.071528;
%     14.41359;
%     15.08972;
%     15.801759;
%     16.524055;
%     17.004604;
%     17.643137;
%     18.036154;
%     18.466652;
%     18.971693;
%     19.479301;
%     19.947374;
%     20.410786;
%     21.333824;
%     21.935129;
%     22.3;
% ];
% 
% I_single_diode = [
%     3.03;
%     3.025451;
%     3.019014;
%     3.013088;
%     3.003587;
%     2.993472;
%     2.974217;
%     2.940751;
%     2.905137;
%     2.833255;
%     2.76899;
%     2.675841;
%     2.521153;
%     2.313479;
%     2.08479;
%     1.674135;
%     0.856181;
%     0.32333;
%     0;
% ];

% % Single-diode emulator - Renogy RNG-50DB-H (S = 1000 W/m^2 and T = 25°C)
% V_single_diode = [
%     0;
%     5.179413;
%     11.411573;
%     15.187758;
%     16.149439;
%     16.624014;
%     17.250757;
%     17.517166;
%     17.929047;
%     18.462984;
%     18.722519;
%     19.081297;
%     19.507757;
%     19.885263;
%     20.378786;
%     20.665606;
%     21.433184;
%     22.157703;
%     22.6;
% ];
% 
% I_single_diode = [
%     2.92;
%     2.914019;
%     2.906022;
%     2.887712;
%     2.871171;
%     2.857385;
%     2.828827;
%     2.811870;
%     2.778083;
%     2.715070;
%     2.674240;
%     2.603673;
%     2.488882;
%     2.359168;
%     2.119580;
%     1.970672;
%     1.205564;
%     0.456983;
%     0;
% ];

% Single-diode emulator - Shell Solar SQ150-PC (S = 1000 W/m^2 and T = 25°C)
V_single_diode = [
    0;
    22.64146;
    24.412127;
    26.068161;
    27.799574;
    28.636826;
    29.45788;
    30.314299;
    31.332647;
    32.268707;
    33.229164;
    33.908855;
    34.641445;
    35.597893;
    36.30035;
    36.647137;
    37.328506;
    38.051414;
    39.146133;
    41.002605;
    43.096004;
    43.4;
];

I_single_diode = [
    4.8;
    4.769958;
    4.762289;
    4.750216;
    4.732023;
    4.718141;
    4.698951;
    4.672532;
    4.628379;
    4.570478;
    4.487823;
    4.411169;
    4.307623;
    4.131216;
    3.959058;
    3.871837;
    3.645755;
    3.398937;
    2.709982;
    1.527292;
    0.193666;
    0;
];

h1 = plot(V_single_diode,  I_single_diode,   '-b',  'LineWidth',2);     

% Simplified exp. emulator - ME Solar MESM-50W (S = 1000 W/m^2 and T = 25°C)
% V_simplified_exp = [
%     0;
%     8.08962;
%     11.45164;
%     14.526568;
%     16.046844;
%     16.94203;
%     17.753181;
%     18.2904;
%     19.387537;
%     20.072838;
%     20.594084;
%     21.106194;
%     21.724693;
%     22.3;
% ];
% 
% I_simplified_exp = [
%     3.03;
%     3.028738;
%     3.021295;
%     2.99427;
%     2.949897;
%     2.878464;
%     2.813736;
%     2.679999;
%     2.389157;
%     2.202046;
%     1.848619;
%     1.501389;
%     0.7471;
%     0;
% ];

% % Simplified exp. - Renogy RNG-50DB-H – 50 W (S = 1000 W/m^2 and T = 25°C)
% V_simplified_exp = [
%     0;
%     6.817072;
%     11.080575;
%     15.057276;
%     16.803661;
%     17.610468;
%     18.552885;
%     19.459518;
%     20.528112;
%     21.02478;
%     21.487143;
%     22.002245;
%     22.6;
% ];
% I_simplified_exp = [
%     2.92;
%     2.919855;
%     2.918193;
%     2.894286;
%     2.843843;
%     2.780185;
%     2.695215;
%     2.44177;
%     2.114295;
%     1.793764;
%     1.483582;
%     0.796883;
%     0;
% ];

% Simplified exp. emulator - Shell Solar SQ150-PC (S = 1000 W/m^2 and T = 25°C)
V_simplified_exp = [
    0;
    25.567003;
    27.200571;
    28.811605;
    30.372927;
    32.341831;
    34.1399;
    36.391037;
    38.724979;
    40.008648;
    41.242683;
    42.378609;
    42.994045;
    43.4;
];

I_simplified_exp = [
    4.8;
    4.747;
    4.733705;
    4.687959;
    4.643624;
    4.51567;
    4.370661;
    3.898574;
    3.404761;
    2.759869;
    2.083102;
    0.986255;
    0.391991;
    0;
];

h2 = plot(V_simplified_exp, I_simplified_exp, '-r', 'LineWidth',2);  % plot simple exponential model

% % Commercial emulator - ME Solar MESM-50W – 50 W (S = 1000 W/m^2 and T = 25°C)
% V_commercial = [
%     1.1;
%     2.7;
%     4.6;
%     6.5;
%     8.5702;
%     9.4;
%     13.06;
%     13.8;
%     16.2;
%     17.6774;
%     18.83;
%     19.4;
%     20.1742;
%     20.939;
%     21.12;
%     21.485;
%     21.7584;
%     21.93;
%     22.1151;
% ];
% 
% I_commercial = [
%     3.0261;
%     3.0203;
%     3.0129;
%     3.0024;
%     2.991;
%     2.985;
%     2.95;
%     2.9382;
%     2.88;
%     2.818;
%     2.59;
%     2.205;
%     1.61;
%     1.033;
%     0.89;
%     0.6146;
%     0.4062;
%     0.2774;
%     0.1343;
% ];

% % Commercial emulator - Renogy RNG-50DB-H – 50 W (S = 1000 W/m^2 and T = 25°C)
% V_commercial = [
%     0;
%     1;
%     1.2329;
%     3.09;
%     5.12;
%     8.5471;
%     10.24;
%     12.12;
%     14.44;
%     15.2639;
%     16.61;
%     17.83;
%     18.35;
%     19.41;
%     19.69;
%     20.02;
%     20.6976;
%     21.1701;
%     21.5176;
%     21.8835;
%     22.0688;
%     22.24;
%     22.5;
% ];
% 
% I_commercial = [
%     2.92;
%     2.917;
%     2.9162;
%     2.9106;
%     2.9031;
%     2.8875;
%     2.8768;
%     2.8623;
%     2.8358;
%     2.8236;
%     2.795;
%     2.756;
%     2.71;
%     2.51;
%     2.289;
%     2.0328;
%     1.5;
%     1.127;
%     0.852;
%     0.5613;
%     0.4157;
%     0.2815;
%     0.0755;
% ];

% Commercial emulator - Renogy RNG-50DB-H (S = 1000 W/m^2 and T = 25°C)
V_commercial = [
    1.55;
    3.4;
    8.22;
    11.75;
    14.85;
    17.9;
    19.52;
    21.8;
    24.55;
    27.47;
    30.13;
    33.09;
    35.9;
    36.8505;
    37.8;
    38.5;
    38.8934;
    39.3103;
    39.5975;
    39.99;
    40.2553;
    40.7371;
    41.228;
    41.7376;
    42.0248;
    42.4047;
    42.6456;
];

I_commercial = [
    4.7949;
    4.7884;
    4.7695;
    4.7529;
    4.735;
    4.715;
    4.7027;
    4.68;
    4.65;
    4.6095;
    4.555;
    4.4518;
    4.1523;
    3.7759;
    3.23;
    2.8289;
    2.6045;
    2.3639;
    2.1974;
    1.9679;
    1.8173;
    1.5363;
    1.252;
    0.9905;
    0.7912;
    0.571;
    0.4338;
];

h3 = plot(V_commercial, I_commercial, '-m', 'LineWidth', 2);  % plot commercial emulator

% % % Real panel data - ME Solar MESM-50W (S = 1000 W/m^2 and T = 25°C)
% V_panel = [
%     0.1345090408816909;
%     3.9418622020801637;
%     7.1102974135229875;
%     10.316096247185497;
%     13.219249737750683;
%     14.493349274149194;
%     15.386339859898216;
%     16.114930504317343;
%     16.794948437178412;
%     17.542220892707384;
%     18.26333881312798;
%     18.943356748216104;
%     19.39172022153349;
%     19.65700194241112;
%     19.90733821529171;
%     20.228665369498877;
%     20.51636526682619;
%     20.882528769478625;
%     21.1702286645789;
%     21.446719472567864;
%     21.71200119344551;
% ];
% 
% I_panel = [
%     3.0107092341738317;
%     2.9969690844678114;
%     2.9832289352435426;
%     2.970297029807906;
%     2.9614063447606873;
%     2.9533239039838524;
%     2.9533239035021017;
%     2.9525156597134687;
%     2.932309557771381;
%     2.880581935547086;
%     2.7868256213795988;
%     2.643766417317217;
%     2.503940189854619;
%     2.3099616083200765;
%     2.122448979503352;
%     1.8508789653549917;
%     1.5663770457709956;
%     1.1840775911493435;
%     0.8163265305040968;
%     0.4598908867537168;
%     0.030713275530074746;
% ];

% Real panel data - Renogy RNG-50DB-H – 50 W (S = 1000 W/m^2 and T = 25°C)
% V_panel = [ 
%     0.061238999661659355;
%     3.0378744826113886;
%     6.06593628879359;
%     9.019207316748718;
%     11.551928051656516;
%     12.757528558290698;
%     13.855704699997231;
%     14.771648303222042;
%     15.865224726830606;
%     16.729902361354295;
%     17.664819810269254;
%     18.450378783493765;
%     19.100584026063657;
%     19.605999152099663;
%     20.04147065780234;
%     20.416281613412224;
%     20.80544927623029;
%     21.20426937792104;
%     21.462738787922408;
%     21.777746419471736;
%     22.02257696007481;
%     22.272296443566514;
%     22.475133634590215;
%     22.579352135807298
% ];
% I_panel = [
%     2.9194630872527965;
%     2.9194630872527965;
%     2.915548098563706;
%     2.915548098563706;
%     2.913870246173136;
%     2.9149888143223963;
%     2.9077181208521656;
%     2.8987695749913653;
%     2.879753914787145;
%     2.848993288182294;
%     2.794742729109542;
%     2.7125279639717688;
%     2.6045861294008548;
%     2.4854586130039786;
%     2.342281879231173;
%     2.1851230434259357;
%     1.9737136465477885;
%     1.713087248101959;
%     1.4787472036639384;
%     1.170022371466326;
%     0.8747203580599141;
%     0.5447427290262028;
%     0.23937360194308832;
%     0.012304250975298636
% ];

% Real panel data - Shell Solar SQ150-PC (S = 1000 W/m^2 and T = 25°C)
V_panel = [
    0.07780604683747905;
    4.2189436898142905;
    7.660223341663279;
    10.863995324097095;
    14.176868703729975;
    17.155893827390162;
    20.141363211697026;
    23.036948208895787;
    24.995167557029617;
    26.42690527335035;
    27.81375668458678;
    29.001602344647385;
    30.36284434236471;
    31.512299834342564;
    32.59122368036738;
    33.76659988606946;
    34.743098058886865;
    35.65550884640268;
    36.446045441351224;
    37.16601846173125;
    37.82826853208371;
    38.47780170128618;
    39.10175339833374;
    39.68073097512157;
    40.29205756197019;
    40.91626468796069;
    41.54063145321372;
    42.171478402636254;
    42.8474591077566;
    43.38200934569101;
];

I_panel = [
    4.804197165221235;
    4.795540075268057;
    4.798166796403276;
    4.789358636164255;
    4.791964661586494;
    4.79244477341078;
    4.786709596059194;
    4.780959931956091;
    4.775059198186533;
    4.773217832998629;
    4.756864468979553;
    4.734262703388705;
    4.699256226304568;
    4.642458468761035;
    4.56182008609613;
    4.442863222890885;
    4.284504230031027;
    4.096089321638853;
    3.878645240109937;
    3.6456489653261293;
    3.397102567352327;
    3.1164364242871767;
    2.809864790583181;
    2.5115743462965194;
    2.1490537237230516;
    1.7761746301469223;
    1.3618533741500927;
    0.9319923422019132;
    0.4524079577975444;
    0.02045929702601157;
];

h4 = plot(V_panel, I_panel, 'ko', ...      % plot real panel data
          'MarkerSize',6, 'MarkerFaceColor','k');
xlabel('Voltage (V)', 'FontSize', 30);
ylabel('Current (A)', 'FontSize', 30);

  xlim([0 45]); 
  ylim([0 5]); 

legend([h1 h2 h3 h4], ...
       {'Open-source PV Emulator – Single Diode Model', 'Open-source PV Emulator – Simplified Exp. Model', 'Commercial PV emulator', 'Real PV panel data'}, ...
       'Location','best');
% Font settings for axis ticks
set(gca, 'FontSize', 30); % Adjusted font size based on your image
% Apply Times New Roman font to all text elements
set(findall(gcf, '-property','FontName'),'FontName','Times New Roman');
set(findall(gca, '-property','FontName'),'FontName','Times New Roman');
hold off; % Release the plot