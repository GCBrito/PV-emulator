# _Emulator's Principle_

This repository presents a C++ algorithm that enables the OwnTech board to operate as a PV emulator capable of reproducing the behavior of any PV module under arbitrary operating points. To achieve this, the user must provide a set of reference parameters obtained from the datasheet of the targeted module. These parameters are typically specified at either **STC** (Standard Test Conditions — 1000 W/m² solar irradiance, AM1.5 spectrum, and a cell temperature of 25 °C) or **NOTC** (Normal Operating Test Conditions — 800 W/m² solar irradiance, AM1.5 spectrum, a cell temperature of 20 °C, and a wind speed of 1 m/s). Once these reference values are defined, the user only needs to specify the temperature and irradiance of the operating point to be emulated.

# _Single-diode model_

The previously mentioned electrical model is a widely used and well-validated approach:

<p align="center">
<img width="500" height="300" alt="Single-diode Model" src="https://github.com/user-attachments/assets/9f7884e0-ffcf-4c9f-9f6b-d501deca426f" />
</p>

By applying Kirchhoff's Laws to this system, one can determine that the DC current _I<sub>pv</sub>_ generated by a PV module is equal to:

$$ I_{pv} = I_ph}^{ref} \left( \frac{S}{S^{ref}} \right) \left[ 1 + \alpha (T - T^{ref}) \right] - I_{s0}^{ref} \left( \frac{T}{T^{ref}} \right)^3 \left( e^{\frac{q(R_s I_{pv} + V_{pv})}{A k T}} - 1 \right) e^{\frac{n_s q}{A k} \left( E_{G0} - \frac{k_1 T^2}{T + k_2} \right) \left( \frac{1}{T^{ref}} - \frac{1}{T} \right)} - \frac{R_S I_{pv} + V_{pv}}{R_p}. $$

Where:  

- $I_{pv}$ — output current [A]
- $I_{ph}^{ref}$ — reference photocurrent [A]
- $S$ — operating irradiance [W/m²]  
- $S^{ref}$ — reference irradiance [W/m²]
- $\alpha$ — temperature coefficient of the short-circuit current [%/°C or %/K] 
- $T$ — operating temperature [K]  
- $T^{ref}$ — reference temperature [K]
- $I_{s0}^{ref}$ — reference saturation current [A]
- $R_s$ — series resistance [Ω]
- $V_{pv}$ — output voltage [V]
- $A$ — diode ideality factor [–]
- $k$ — Boltzmann constant = 1.3806503 × 10⁻²³ [J/K]
- $n_s$ - Number of cells in series [–]
- $q$ — elementary charge = 1.60217646 × 10⁻¹⁹ [C]
- $E_{G0}$ — Bandgap energy at 0 K, equal to 1.166 eV for silicon cells [eV]
- $k_1$ — Material-dependent coefficient, equal to 4.73 × 10⁻¹⁹ eV/K for silicon cells [eV/K]
- $k_2$ — Empirical constant, equal to 636 K for silicon cells [K]            
- $R_p$ — parallel resistance [Ω]

It can be observed that the current _I<sub>pv</sub>_ is a function of itself, of the output voltage, and of the climatic variables irradiance and temperature ($I_{pv}$ = f($I_{pv}$, $V_{pv}$, $S$, $T$)). Obviously, it is not possible to analytically isolate the output current $I_{pv}$. Therefore, this equation can only be solved using iterative numerical methods. In addition, some parameters of the equation must be determined or specified, as they depend on the photovoltaic module but are not provided in the manufacturers' datasheets. These are the five parameters: $R_s$, $R_p$, $A$, $I_{s0}^{ref}$, and $I_{ph}^{ref}$.

From mathematical theory, it is known that solving a system with five unknowns requires five independent equations. Therefore, to solve the PV current equation, it is first necessary to determine the following system of equations:

$$
\begin{aligned}
I_{ph}^{ref} &- I_{s0}^{ref}\big(e^{\tfrac{q R_s I_{sc}^{ref}}{A k T^{ref}}} - 1\big) - \frac{R_s I_{sc}^{ref}}{R_p} &= I_{sc}^{ref} \\
I_{ph}^{ref} &- I_{s0}^{ref}\big(e^{\tfrac{q V_{oc}^{ref}}{A k T^{ref}}} - 1\big) - \frac{V_{oc}^{ref}}{R_p} &= 0 \\
I_{ph}^{ref} &- I_{s0}^{ref}\big(e^{\tfrac{q (R_s I_{mp}^{ref}+V_{mp}^{ref})}{A k T^{ref}}} - 1\big) - \frac{R_s I_{mp}^{ref}+V_{mp}^{ref}}{R_p} &= I_{mp}^{ref} \\
R_s &+ \frac{q I_{s0}^{ref} R_p (R_s - R_p)}{A k T^{ref}} e^{\tfrac{q I_{sc}^{ref}}{A k T^{ref}}} &= 0 \\
I_{ph}^{ref} &- \frac{2 V_{mp}^{ref}}{R_p} - I_{s0}^{ref}\Big(\big[1+\tfrac{q (V_{mp}^{ref}-R_s I_{mp}^{ref})}{A k T^{ref}}\big] e^{\tfrac{q (R_s I_{mp}^{ref}+V_{mp}^{ref})}{A k T^{ref}}} - 1\Big) &= 0
\end{aligned}
$$

In this system, the remaining parameters are:

- $V_{oc}^{ref}$ — open-circuit voltage at the reference operating point [V]  
- $I_{sc}^{ref}$ — short-circuit current at the reference operating point [A]  
- $V_{mp}^{ref}$ — voltage at the maximum power point at the reference operating point [V]  
- $I_{mp}^{ref}$ — current at the maximum power point at the reference operating point [A]

Through these equations, the I–V characteristic curve of any PV module can be determined. The single-diode model differs from the [simplified exponential model](https://github.com/GCBrito/PV-emulator/tree/main/Simplified%20exponential%20model) because it accounts for the influence of both temperature and irradiance on the PV panel. This makes it possible to emulate the module under any operating condition, whereas the simplified model only allowed simulation at STC or NOTC.

# _Algorithms_

The algorithms in this repository enable the implementation of the single-diode model on the PV emulator.  To use this emulator, the user must specify the PV module to be replicated and define the desired operating point by providing the following input parameters, which are typically available in manufacturers’ datasheets:

- **ns** — number of cells in series [–]  
- **np** — number of parallel strings [–]  
- **Vmp_mod_ref** — module voltage at the maximum power point under the reference operating condition [V]  
- **Imp_mod_ref** — module current at the maximum power point under the reference operating condition [A]  
- **Voc_mod_ref** — module open-circuit voltage under the reference operating condition [V]  
- **Isc_mod_ref** — module short-circuit current under the reference operating condition [A]  
- **Tref** — reference temperature [K]  
- **Sref** — reference irradiance [W/m²]  
- **alpha** — temperature coefficient of the short-circuit current [%/°C or %/K]  
- **T** — operating temperature [K]  
- **S** — operating irradiance [W/m²]  

This folder contains two **auxiliary plotting scripts** — one in MATLAB and one in Python:

- "tracer_single_diode_emulator" — Determines the five parameters required for the single-diode model by solving the nonlinear system of equations. Additionally, it can plot both the emulated operating points as well as the PV emulator’s testing points and the load lines, and compare them to the theoretical I–V curve.
- "comparison_single_diode_emulator_real_pv" — Compares the emulated I–V curve to experimental data from a real PV module.

# _Usage instructions_

**To use the emulator**, start by running `tracer_single_diode_emulator` (in MATLAB or Python) to calculate the five model parameters. Once computed, these parameters must be manually entered into `main.cpp` before uploading the firmware to the SPIN board. For detailed, step-by-step instructions, refer to the [Tutorial](https://github.com/GCBrito/PV-emulator/blob/main/Tutorial.md).

