This emulator is based on the single-diode model, a widely used and well-validated approach:

<p align="center">
<img width="500" height="300" alt="Single-diode Model" src="https://github.com/user-attachments/assets/9f7884e0-ffcf-4c9f-9f6b-d501deca426f" />
</p>

By applying Kirchhoff's Laws to this system, one can determine that the DC current _I<sub>pv</sub>_ generated by a PV module is equal to:

$$ I_{pv} = I_{PH}^{ref} \left( \frac{S}{S^{ref}} \right) + \mu_{ICC}(T - T^{ref}) - \frac{R_S I_{pv} + V_{pv}}{R_P} - I_{S0}^{ref} \left( \frac{T}{T^{ref}} \right)^3 e^{\frac{qE_G}{Ak}\left(\frac{1}{T^{ref}} - \frac{1}{T}\right)} \left[ e^{\frac{q(R_S I_{pv} + V_{pv})}{AkT}} - 1 \right] $$

Where:  

- _I<sub>pv</sub>_ — output current [A]
- _I<sub>PH</sub><sup>ref</sup>_ — reference photocurrent [A]
- _S_ — operating irradiance [W/m²]  
- _S<sub>ref</sub>_ — reference irradiance [W/m²]
- _μ<sub>ICC</sub>_ — temperature coefficient of the short-circuit current [A/°C or A/K] 
- _V<sub>pv</sub>_ — output voltage [V]
- _T_ — operating temperature [K]  
- _T<sub>ref</sub>_ — reference temperature [K]
- _R<sub>S</sub>_ — series resistance [Ω]
- _V<sub>pv</sub>_ — output voltage [A]
- _R<sub>P</sub>_ — series resistance [Ω]
- _I<sub>S0</sub><sup>ref</sup>_ — reference saturation current [A]
- _q_ — elementary charge = 1.60217646 × 10⁻¹⁹ [C]
- _E<sub>G</sub>_ — band-gap energy, equal to 1.21 eV for silicon [eV]   
- _A_ — diode ideality factor [–]   
- _k_ — Boltzmann constant = 1.3806503 × 10⁻²³ [J/K]

It can be observed that the current _I<sub>pv</sub>_ is a function of itself, of the output voltage, and of the climatic variables irradiance and temperature (_I<sub>pv</sub> = f(I<sub>pv</sub>, V<sub>pv</sub>, S, T)_). Obviously, it is not possible to analytically isolate the output current _I<sub>pv</sub>_. Therefore, this equation can only be solved using iterative numerical methods. In addition, some parameters of the equation must be determined or specified, as they depend on the photovoltaic module but are not provided in the manufacturers' datasheets. These are the five parameters: _R<sub>s</sub>_, _R<sub>p</sub>_, _A_, _I<sub>S0</sub><sup>ref</sup>_, and _I<sub>PH</sub><sup>ref</sup>_.

From mathematical theory, it is known that solving a system with five unknowns requires five independent equations. Therefore, to solve the PV current equation, it is first necessary to determine the following system of equations:

The system of equations is given by:

$$
\begin{aligned}
I_{PH}^{ref} &- I_{S0}^{ref}\big(e^{\tfrac{q R_S I_{SC}}{A k T^{ref}}} - 1\big) - \frac{R_S I_{SC}}{R_P} &= I_{SC} \\
I_{PH}^{ref} &- I_{S0}^{ref}\big(e^{\tfrac{q V_{OC}}{A k T^{ref}}} - 1\big) - \frac{V_{OC}}{R_P} &= 0 \\
I_{PH}^{ref} &- I_{S0}^{ref}\big(e^{\tfrac{q (R_S I_{MP}+V_{MP})}{A k T^{ref}}} - 1\big) - \frac{R_S I_{MP}+V_{MP}}{R_P} &= I_{MP} \\
R_S &+ \frac{q I_{S0}^{ref} R_P (R_S - R_P)}{A k T^{ref}} e^{\tfrac{q I_{SC}}{A k T^{ref}}} &= 0 \\
I_{PH}^{ref} &- \frac{2 V_{MP}}{R_P} - I_{S0}^{ref}\Big(\big[1+\tfrac{q (V_{MP}-R_S I_{MP})}{A k T^{ref}}\big] e^{\tfrac{q (R_S I_{MP}+V_{MP})}{A k T^{ref}}} - 1\Big) &= 0
\end{aligned}
$$


In this system, the remaining parameters are:

- _V<sub>OC</sub>_ — open-circuit voltage at the reference operating point [V]  
- _I<sub>SC</sub>_ — short-circuit current at the reference operating point [A]  
- _V<sub>MPP</sub>_ — voltage at the maximum power point at the reference operating point [V]  
- _I<sub>MPP</sub>_ — current at the maximum power point at the reference operating point [A]

Through these equations, the I–V characteristic curve of any PV module can be determined.  
The single-diode model differs from the [simplified exponential model](https://github.com/GCBrito/PV-emulator/tree/main/Simplified%20exponential%20model) because it accounts for the influence of both temperature and irradiance on the PV panel. This makes it possible to emulate the module under any operating condition, whereas the simplified model only allowed simulation at STC or NOTC.

# _Algorithms_

The algorithms in this repository enable the implementation of the single-diode model on the PV emulator.  To use this emulator, the user must specify the PV module to be replicated and define the desired operating point by providing the following input parameters, which are typically available in manufacturers’ datasheets:

- **ns** — number of cells in series [–]  
- **np** — number of parallel strings [–]  
- **VMPmod** — module voltage at the maximum power point under the reference operating condition [V]  
- **IMPmod** — module current at the maximum power point under the reference operating condition [A]  
- **VOCmod** — module open-circuit voltage under the reference operating condition [V]  
- **ISCmod** — module short-circuit current under the reference operating condition [A]  
- **Tref** — reference temperature [K]  
- **Sref** — reference irradiance [W/m²]  
- **muICC** — temperature coefficient of the short-circuit current [A/°C or A/K]  
- **T** — operating temperature [K]  
- **S** — operating irradiance [W/m²]  

This folder contains two **MATLAB** scripts:

- "tracer_single_diode_emulator.m" — Determines the five parameters required for the single-diode model by solving the nonlinear system of equations. Additionally, it can plot both the emulated operating points as well as the PV emulator’s testing points and the load lines, and compare them to the theoretical I–V curve.
- "comparison_single_diode_emulator_real_pv.m" — Compares the emulated I–V curve to experimental data from a real PV module.

# _Usage instructions_

**To use the emulator**, begin by running "tracer_single_diode_emulator.m" to compute the five model parameters. Once obtained, these parameters must be manually inserted into main.cpp before uploading the firmware to the SPIN board.
