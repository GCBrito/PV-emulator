This emulator is based on the single-diode mathematical model, shown by the following figure:

<p align="center">
<img width="500" height="300" alt="Single-diode Model" src="https://github.com/user-attachments/assets/9f7884e0-ffcf-4c9f-9f6b-d501deca426f" />
</p>

By applying Kirchhoff's Laws to this system, one can determine that the DC current _I<sub>pv</sub>_ generated by a PV module is equal to:

$$ I_{pv} = I_{PH}^{ref} \left( \frac{S}{S^{ref}} \right) + \mu_{ICC}(T - T^{ref}) - \frac{R_S I_{pv} + V_{pv}}{R_P} - I_{S0}^{ref} \left( \frac{T}{T^{ref}} \right)^3 e^{\frac{qE_G}{Ak}\left(\frac{1}{T^{ref}} - \frac{1}{T}\right)} \left[ e^{\frac{q(R_S I_{pv} + V_{pv})}{AkT}} - 1 \right] $$

Where:  

- _I<sub>pv</sub>_ — output current [A]
- _I<sub>PH</sub><sup>ref</sup>_ — reference photocurrent [A]
- _S_ — operating irradiance [W/m²]  
- _S<sub>ref</sub>_ — reference irradiance [W/m²]
- _μ<sub>ICC</sub>_ — temperature coefficient of the short-circuit current [A/°C or A/K] 
- _V<sub>pv</sub>_ — output voltage [V]
- _T_ — operating temperature [K]  
- _T<sub>ref</sub>_ — reference temperature [K]
- _R<sub>S</sub>_ — series resistance [Ω]
- _V<sub>pv</sub>_ — output voltage [A]
- _R<sub>P</sub>_ — series resistance [Ω]
- _I<sub>S0</sub><sup>ref</sup>_ — reference saturation current [A]
- _q_ — elementary charge = 1.60217646 × 10⁻¹⁹ [C]
- _E<sub>G</sub>_ — band-gap energy, equal to 1.21 eV for silicon [eV]   
- _A_ — diode ideality factor [–]   
- _k_ — Boltzmann constant = 1.3806503 × 10⁻²³ [J/K]

It can be observed that the current _I<sub>pv</sub>_ is a function of itself, of the output voltage, and of the climatic variables irradiance and temperature (_I<sub>pv</sub> = f(I<sub>pv</sub>, V<sub>pv</sub>, S, T)_). Obviously, it is not possible to analytically isolate the output current _I<sub>pv</sub>_. Therefore, this equation can only be solved using iterative numerical methods. In addition, some parameters of the equation must be determined or specified, as they depend on the photovoltaic module but are not provided in the manufacturers' datasheets. These are the five parameters: _R<sub>s</sub>_, _R<sub>p</sub>_, _A_, _I<sub>S0</sub><sup>ref</sup>_, and _I<sub>PH</sub><sup>ref</sup>_.

From mathematical theory, it is known that solving a system with five unknowns requires five independent equations. Therefore, to solve the PV current equation, it is first necessary to determine the following system of equations:

The system of equations is given by:

$$
\begin{cases}
I_{CC} = I_{PH}^{ref} - I_{S0}^{ref}\left[e^{\tfrac{q R_S I_{CC}}{A k T^{ref}}} - 1\right] - \dfrac{R_S I_{CC}}{R_P} \\[1em]
0 = I_{PH}^{ref} - I_{S0}^{ref}\left[e^{\tfrac{q V_{CA}}{A k T^{ref}}} - 1\right] - \dfrac{V_{CA}}{R_P} \\[1em]
I_{MP} = I_{PH}^{ref} - I_{S0}^{ref}\left[e^{\tfrac{q (R_S I_{MP}+V_{MP})}{A k T^{ref}}} - 1\right] - \dfrac{R_S I_{MP}+V_{MP}}{R_P} \\[1em]
R_S + \dfrac{q I_{S0}^{ref} R_P (R_S - R_P)}{A k T^{ref}} e^{\tfrac{q I_{CC}}{A k T^{ref}}} = 0 \\[1em]
I_{PH}^{ref} - \dfrac{2 V_{MP}}{R_P} - I_{S0}^{ref}\left\{\left[1+\dfrac{q (V_{MP}-R_S I_{MP})}{A k T^{ref}}\right] e^{\tfrac{q (R_S I_{MP}+V_{MP})}{A k T^{ref}}} - 1\right\} = 0
\end{cases}
$$

 
- _n<sub>s</sub>_ — number of cells in series [–]  
- _n<sub>p</sub>_ — number of parallel strings [–]  
- _V<sub>OC,mod</sub>_ — open-circuit voltage at the reference operating point [V]  
- _I<sub>SC,mod</sub>_ — short-circuit current at the reference operating point [A]  
- _V<sub>MPP,mod</sub>_ — voltage at the maximum power point at the reference operating point [V]  
- _I<sub>MPP,mod</sub>_ — current at the maximum power point at the reference operating point [A]    
- _R<sub>P</sub>_ — shunt (parallel) resistance [Ω]  


 To configure the emulation, the user must specify the photovoltaic (PV) module to replicate and define the desired operating point by providing the following input parameters:

- ns - number of cells in series [-]
- np - number of parallel strings [-] 
- VMPmod - voltage at the maximum power point [V]
- IMPmod - current at the maximum power point [A]
- VOCmod - open-circuit voltage [V]
- ISCmod - short-circuit current [A]
- Tref - reference temperature [K]
- Sref - reference irradiance [W/m^2] 
- muICC - temperature coefficient of the short-circuit current [A/ºC]
- T - operating temperature [K]
- S - operating irradiance [W/m^2]

This folder contains two MATLAB scripts:

- "tracer_single_diode_emulator.m": Determines the five parameters required for the single-diode model by solving a nonlinear system of equations. Additionally, it can plot both the emulated operating points as well as the PV emulator’s testing points and the load lines, and compare them to the theoretical I–V curve.
- "comparison_single_diode_emulator_real_pv.m": Compares the emulated I–V curve to experimental data from a real PV module.

*Usage instructions:*

To use the emulator, begin by running "tracer_single_diode_emulator.m" to compute the five model parameters. Once obtained, these parameters must be manually inserted into main.cpp before uploading the firmware to the SPIN board.
