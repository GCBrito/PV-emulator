clear, clc, close all;

ns = 72;       % number of series cells

Vmp_mod_ref = 17.4;     % voltage at maximum power point (V)
Imp_mod_ref = 5.02;     % current at maximum power point (A)
Voc_mod_ref = 21.7;     % open-circuit voltage (V)
Isc_mod_ref = 5.34;     % short-circuit current (A)

Tref = 25 + 273.15; % Reference temperature (K)
Gref = 1000; % Reference irradiance (W/m²)

alpha   = 0.0004;  % temperature coefficient of Isc (1/K or 1/ºC)
beta = -0.38; % temperature coefficient of Voc (1/K or 1/ºC)

T = 25 + 273.15; % Current temperature (K)
G = 400; % Current irradiance (W/m²)

Isc_estimation = (G/Gref)*Isc_mod_ref*(1+alpha*(T-Tref));
Voc_estimation = Voc_mod_ref*(1+beta*(T-Tref));

%% 1) Display of the three curves + experimental points
figure('Color','w','Position',[100 100 900 500]);
hold on; grid on;

% Single diode emulator - CanadianSolar CS6P-250P (G = 765 W/m^2 and T = 44.5°C)
% V_emulator = [
%     0;
%     20.089266;
%     21.406616;
%     22.612379;
%     23.688374;
%     24.878904;
%     25.916357;
%     26.656096;
%     27.416744;
%     28.124405;
%     28.616514;
%     29.345022;
%     30.058086;
%     30.656363;
%     31.281769;
%     31.720699;
%     32.716629;
%     33.539886;
%     34.182873;
%     Voc_estimation
% ];
% 
% I_emulator = [
%     Isc_estimation;
%     6.829757;
%     6.817284;
%     6.802004;
%     6.776401;
%     6.723669;
%     6.645714;
%     6.558634;
%     6.430365;
%     6.261077;
%     6.106682;
%     5.808709;
%     5.411033;
%     4.959418;
%     4.459889;
%     3.826633;
%     2.389792;
%     1.202061;
%     0.274412;
%     0
% ];

% % Single diode emulator - Kyocera KB260-6BPA (G = 735 W.m^-2 and T = 33.6 ºC)
% V_emulator = [
%     0;
%     24.568945;
%     25.582468;
%     26.636724;
%     27.760311;
%     28.505875;
%     29.370399;
%     29.870871;
%     30.389585;
%     30.910389;
%     31.497862;
%     32.049358;
%     32.373322;
%     32.652031;
%     33.040810;
%     33.570869;
%     34.342472;
%     35.130131;
%     36.306252;
%     36.4
% ];
% 
% I_emulator = [
%     Isc_estimation;
%     6.577370;
%     6.550722;
%     6.504035;
%     6.426134;
%     6.348569;
%     6.220003;
%     6.120357;
%     5.993034;
%     5.834084;
%     5.608923;
%     5.326514;
%     5.157776;
%     4.962690;
%     4.667143;
%     4.264192;
%     3.169607;
%     1.997071;
%     0.246257;
%     0
% ];

% Single diode emulator - Kyocera KC200GT (G = 511 W.m^-2 and T = 54.3 ºC)
% V_emulator = [
%     0;
%     9.868175;
%     13.614193;
%     16.422968;
%     17.876022;
%     19.423361;
%     20.185144;
%     21.167236;
%     22.170599;
%     23.001207;
%     23.76317;
%     24.581303;
%     25.310093;
%     25.86165;
%     26.282421;
%     26.626436;
%     27.169167;
%     27.623262;
%     27.982399;
%     28.25
% ];
% 
% I_emulator = [
%     4.215;
%     4.213981;
%     4.200723;
%     4.184036;
%     4.162126;
%     4.127219;
%     4.09778;
%     4.037549;
%     3.935331;
%     3.803022;
%     3.624704;
%     3.350668;
%     3.010062;
%     2.653071;
%     2.367517;
%     1.948026;
%     1.28622;
%     0.732496;
%     0.294568;
%     0;
% ];

% Single diode emulator - R - Kyocera KC85TS (STC)

V_emulator = [
    0;
    3.771689;
    11.757546;
    13.462190;
    15.029916;
    15.729580;
    16.312876;
    16.803375;
    17.031826;
    17.267950;
    17.583126;
    17.934851;
    18.304523;
    18.780472;
    19.152412;
    19.492191;
    19.843899;
    20.207394;
    20.323677;
    20.6
];

I_emulator = [
    Isc_estimation;
    2.132660;
    2.125153;
    2.121503;
    2.111920;
    2.100471;
    2.082573;
    2.056799;
    2.040040;
    2.018001;
    1.980066;
    1.921715;
    1.834649;
    1.677932;
    1.482750;
    1.299517;
    0.877512;
    0.441359;
    0.301833;
    0
];


% Single diode emulator - R+L - Kyocera KC85TS (STC)
% 
% V_emulator = [
%     0
%     5.422981;
%     10.325287;
%     12.457455;
%     13.701180;
%     15.073689;
%     15.675177;
%     16.085083;
%     16.439856;
%     16.966587;
%     17.350945;
%     17.817669;
%     18.280350;
%     18.678190;
%     19.048414;
%     19.429449;
%     19.783800;
%     20.036785;
%     20.337690;
%     20.6;
% ];
% 
% I_emulator = [
%     Isc_estimation;
%     2.131196;
%     2.126768;
%     2.123983;
%     2.120913;
%     2.111396;
%     2.101856;
%     2.090854;
%     2.077012;
%     2.045084;
%     2.009011;
%     1.942870;
%     1.842608;
%     1.711611;
%     1.537975;
%     1.335638;
%     0.949623;
%     0.646071;
%     0.285019;
%     0
% ];

h1 = plot(V_emulator,  I_emulator,   '-b',  'LineWidth',2);     % plot single diode emulator

% Real panel data - CanadianSolar CS6P-250P (S = 765 W/m^2 and T = 44.5°C)
% V_panel = [
%     0.047996217771366645;
%     2.5473136313978317;
%     4.686489351002983;
%     7.605990366562553;
%     10.181947580363017;
%     12.610309040298777;
%     14.79342630980413;
%     17.20541669131795;
%     19.415489834424953;
%     21.816632013769198;
%     24.03214755291164;
%     26.237334370932288;
%     28.26322957001055;
%     29.749962170030145;
%     31.046437882063465;
%     31.92801141798128;
%     32.689215781035756;
%     33.25368190774834;
%     33.59447586154349;
%     34.38443600476654
% ];
% 
% I_panel = [
%     7.007823910286788;
%     7.0079635369891475;
%     7.001379133258391;
%     7.003776871281191;
%     6.93017776227956;
%     6.9347826983712295;
%     6.841049913320265;
%     6.845653933494394;
%     6.8524813120762555;
%     6.83697299652661;
%     6.848269952562965;
%     6.68079538185797;
%     6.2719700120743145;
%     5.5323882664885256;
%     4.567097566839892;
%     3.6531803358379182;
%     2.83534576727134;
%     2.1046510438953376;
%     1.3538320938536454;
%     0.08683712275429656
% ];

% % Single diode emulator - Kyocera KB260-6BPA (G = 735 W/m^2 and T = 33,6ºC)
% V_panel = [
%     0.0455969407525445;
%     2.9271959778498773;
%     4.902704170259113;
%     6.88347582118527;
%     9.038080417500383;
%     11.176899184353912;
%     13.510629760851112;
%     15.860159814501406;
%     18.0095873908246;
%     20.332779674072395;
%     22.6717646106255;
%     24.857993191432502;
%     26.98107843870138;
%     29.141271766676834;
%     30.932938702702867;
%     32.3931145335085;
%     33.45817143875639;
%     34.191355106534374;
%     34.68732138929362;
%     35.25719902557649;
%     35.78478474359848;
%     36.30708425066834;
% ];
% 
% I_panel = [
%     6.727119597608984;
%     6.729434019490265;
%     6.725222853395946;
%     6.725329760352628;
%     6.736240521267449;
%     6.7298792755918075;
%     6.727846338739699;
%     6.730132042305772;
%     6.6546867392647755;
%     6.654812127477331;
%     6.6657328411244094;
%     6.661533046823786;
%     6.588245218439663;
%     6.294752137400725;
%     5.778873016808391;
%     4.88948723260063;
%     4.017351278763285;
%     3.1344029398705855;
%     2.4004055294681965;
%     1.5152894827191918;
%     0.7704993045386512;
%     0.04297999950084552;
% ];

% Single diode emulator - Kyocera KC200GT (S = 511 W.m^-2 and T = 54.3 ºC)
% V_panel = [
%     0.06633956327079193;
%     2.7458921458044943;
%     4.750187578542191;
%     6.738397879641979;
%     8.55510640498975;
%     10.398634093999334;
%     12.247397477176047;
%     14.085538251089517;
%     15.92895053464986;
%     17.767131103542148;
%     19.471307382584936;
%     21.31996331611866;
%     22.868301124243413;
%     24.28771513306349;
%     25.433614258948253;
%     26.2901123451705;
%     26.830422064051454;
%     27.41886779290256;
%     27.846553737021324;
%     28.24767918166411;
% ];
% 
% I_panel = [
%     4.14356789750856;
%     4.1571047845181806;
%     4.161687801527659;
%     4.161814349519464;
%     4.155246813078904;
%     4.162047320620259;
%     4.099788754649053;
%     4.090994861739706;
%     4.0331914003872384;
%     4.046674736070509;
%     4.044555482254624;
%     3.922148395763573;
%     3.6816528875172967;
%     3.2696145187726584;
%     2.7439448794896295;
%     2.2115736529084318;
%     1.6769545779212427;
%     1.0888732202257323;
%     0.5074647987806244;
%     0.05749032916413199;
% ];

% Real panel data - Kyocera KC85TS (S = 400 W/m^2 and T = 25°C)
V_panel = [
    20.981002130722764;
    0.06608783557910758;
    2.087423154611276;
    3.7422899997017183;
    5.503561760222222;
    7.335766446749726;
    9.179774931381964;
    10.834674829311304;
    12.678672292808942;
    14.39267378341276;
    15.598401507942457;
    16.49682293222942;
    17.17673915663834;
    17.732773312588492;
    18.17067586419277;
    18.620630027412773;
    19.04114353518865;
    19.485584047785522;
    19.894706778785416;
    20.286231201766142;
    20.54744023267662;
];

I_panel = [
    0.020684459626193252;
    2.1848822023067904;
    2.1729592301689484;
    2.168795023167493;
    2.160178040675044;
    2.149337974661873;
    2.1418545624403293;
    2.130981453493248;
    2.1257343416974335;
    2.114872247505312;
    2.103915432139303;
    2.088428741983925;
    2.038238640744611;
    1.9410630969490947;
    1.829329572532087;
    1.6706359366326193;
    1.4895737887520175;
    1.2503722307386989;
    0.9820921567196246;
    0.6869731713502247;
    0.4510919206320487;
];

h2 = plot(V_panel, I_panel, 'ko', ...      % plot real panel data
          'MarkerSize',6, 'MarkerFaceColor','k');

xlabel('Voltage (V)', 'FontSize', 30);
ylabel('Current (A)', 'FontSize', 30); 

% Axis limits to match the provided figure
xlim([0 23]);
% ylim([0 1.1*Isc_estimation]);

legend([h1 h2], ...
       {'Open-source PVE (single-diode model)', 'Real PV panel'}, ...
       'Location','best');

% Axis ticks font configuration
set(gca, 'FontSize', 30); % Adjusted font size based on your image

% Apply Times New Roman font to all text elements
set(findall(gcf, '-property','FontName'),'FontName','Times New Roman');
set(findall(gca, '-property','FontName'),'FontName','Times New Roman');
